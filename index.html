<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detectify by EngageAI - AI-Powered Chatbot Detection Platform</title>
    <meta name="description" content="Discover and analyze chatbot technologies across local businesses with Detectify by EngageAI. The ultimate tool for data-driven prospecting in conversational AI." />
    <meta name="author" content="EngageAI" />
    <meta property="og:image" content="/og-image.png" />
    <script>
      // Initialize communication channel
      const channel = new BroadcastChannel('detectify-channel');
      
      // Message types
      const MESSAGE_TYPES = {
        UPDATE_ELEMENTS: 'UPDATE_SELECTED_ELEMENTS',
        TOGGLE_SELECTOR: 'TOGGLE_SELECTOR',
        ELEMENTS_UPDATED: 'ELEMENTS_UPDATED',
        SELECTOR_TOGGLED: 'SELECTOR_TOGGLED',
        ERROR: 'ERROR'
      };

      // Handle incoming messages
      channel.onmessage = function(event) {
        try {
          console.log('Received message:', event.data);
          
          if (!event.data || !event.data.type) {
            console.warn('Invalid message format');
            return;
          }

          switch(event.data.type) {
            case MESSAGE_TYPES.UPDATE_ELEMENTS:
              handleElementUpdate(event.data);
              break;
            case MESSAGE_TYPES.TOGGLE_SELECTOR:
              handleSelectorToggle(event.data);
              break;
            default:
              console.log('Unhandled message type:', event.data.type);
          }
        } catch (error) {
          console.error('Error processing message:', error);
          channel.postMessage({
            type: MESSAGE_TYPES.ERROR,
            error: error.message
          });
        }
      };

      // Handle element updates
      function handleElementUpdate(data) {
        console.log('Handling element update:', data);
        channel.postMessage({
          type: MESSAGE_TYPES.ELEMENTS_UPDATED,
          success: true
        });
      }

      // Handle selector toggle
      function handleSelectorToggle(data) {
        console.log('Handling selector toggle:', data);
        channel.postMessage({
          type: MESSAGE_TYPES.SELECTOR_TOGGLED,
          success: true
        });
      }

      // Helper function to send messages
      window.sendMessage = function(message) {
        try {
          console.log('Sending message:', message);
          channel.postMessage(message);
        } catch (error) {
          console.error('Error sending message:', error);
        }
      };

      // Error handling
      channel.onmessageerror = function(error) {
        console.error('Channel error:', error);
      };

      // Cleanup on page unload
      window.addEventListener('unload', () => {
        channel.close();
      });

      console.log('Communication channel initialized');
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>